#!/usr/bin/php
<?php
$rootDir = dirname(__FILE__) . '/../';

include $rootDir . '/vendor/api-php/OpenPhotoOAuth.php';
include $rootDir . '/src/syncLogger.class.php';
include $rootDir . '/src/OpenPhotoOAuthFactory.class.php';
include $rootDir . '/src/functions.php';
include $rootDir . '/config/defaults.php';

$dir          = $argv[1];
$oAuthFactory = new OpenPhotoOAuthFactory();
$client       = $oAuthFactory->create($config);
$logger       = new syncLogger();
$hashs        = getHashs($client);
$paths        = getPaths($dir);

$logger->log(sprintf('%s photos on openphoto', count($hashs)));

foreach ($paths as $pathName)
{
  uploadFile($client, $logger, $config['exiftran'], $hashs, $pathName);
}

$newHashs = getHashs($client);
$logger->log(sprintf('%s photos added', count($newHashs) - count($hashs)));
$logger->log(sprintf('%s photos now on openphoto', count($hashs)));
